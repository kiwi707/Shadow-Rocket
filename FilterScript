let customCharStart = "◎";
let customCharEnd = "ᵀᶻ";

// 关键词和对应的指定名称
const keywordsToNames = {
    "美|西雅图": "🇺🇸US",
    "港": "🇭🇰HK",
    "新": "🇸🇬SG",
    "台": "🇨🇳TW",
    "日|东京": "🇯🇵JP",
    "韩国": "🇰🇷KR",
    "土耳其": "🇹🇷TR",
    "爱尔兰": "🇮🇪IRL",
    "澳": "🇦🇺AU",
    "法国|巴黎": "🇫🇷FRA",
    // 继续添加其他关键词和对应名称
};

// 要过滤掉的关键词
const filterKeywords = [
    "广告", "过期", "无效", "测试", "备用", "官网", "账号", "有效期", "群", "到期", "刷新", "剩余", "过期", "电报", "会员", "解锁", "流量", "超时", "订阅", "佣金", "免翻", "节点", "下载", "流量", "更新", "点外", "重置", "免流", "Days", "Date", "Expire", "Premium", "建议", "免费"  // 添加您想要过滤掉的关键词
];

// 不做处理但要保留的关键词
const skipKeywords = [
    "GPT",  // 添加您希望保留下来的关键词
];

// 检查是否包含过滤关键词
for (const filter of filterKeywords) {
    if (new RegExp(filter, 'i').test($server.title)) {
        return false;  // 如果匹配过滤关键词，直接返回 false
    }
}

// 保留的关键词 (如 GPT)
let preservedParts = [];
let titleWithoutSkipKeywords = $server.title;

// 检查是否包含不处理关键词
for (const skip of skipKeywords) {
    const skipRegex = new RegExp(skip, 'i');
    if (skipRegex.test($server.title)) {
        const match = $server.title.match(skipRegex);
        if (match) {
            preservedParts.push(match[0]);  // 保留匹配到的关键词
            titleWithoutSkipKeywords = titleWithoutSkipKeywords.replace(skipRegex, '');  // 去除不处理关键词后的部分
        }
    }
}

let newTitle = titleWithoutSkipKeywords;  // 初始值为去除保留关键词后的标题部分
let matchedReplacementKeyword = false;

// 遍历关键词，如果匹配则替换名称
for (const keyword in keywordsToNames) {
    if (new RegExp(keyword, 'i').test(newTitle)) {
        newTitle = keywordsToNames[keyword];  // 替换为对应名称
        matchedReplacementKeyword = true;  // 标记为匹配了替换关键词
        break;  // 找到后直接跳出循环
    }
}

// 最终处理名称
if (matchedReplacementKeyword) {
    // 如果只匹配到替换关键词，进行替换
    // newTitle 已经在上面被赋值为指定名称
} else {
    newTitle = $server.title;  // 保留原名称
}

// 添加前缀字符
newTitle = customCharStart + newTitle;

// 处理重复计数
const map = globalThis.map || (globalThis.map = {});
if (!map[newTitle]) {
    map[newTitle] = 1;
} else {
    const idx = ++map[newTitle];
    newTitle = `${newTitle}-${idx}`;
}

// 添加后缀字符
newTitle += customCharEnd;

// 将保留的关键词添加到标题后面
if (preservedParts.length > 0) {
    newTitle = newTitle + ' ' + preservedParts.join(' ');  // 将保留的部分拼接到新标题的后面
}

// 更新服务器标题
$server.title = newTitle;

return true;
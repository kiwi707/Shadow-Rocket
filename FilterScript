let customCharStart = "â—";
let customCharEnd = "áµ€á¶»";

// å…³é”®è¯å’Œå¯¹åº”çš„æŒ‡å®šåç§°
const keywordsToNames = {
    "ç¾|è¥¿é›…å›¾": "ğŸ‡ºğŸ‡¸US",
    "æ¸¯": "ğŸ‡­ğŸ‡°HK",
    "æ–°": "ğŸ‡¸ğŸ‡¬SG",
    "å°": "ğŸ‡¨ğŸ‡³TW",
    "æ—¥|ä¸œäº¬": "ğŸ‡¯ğŸ‡µJP",

    // ç»§ç»­æ·»åŠ å…¶ä»–å…³é”®è¯å’Œå¯¹åº”åç§°
};

// è¦è¿‡æ»¤æ‰çš„å…³é”®è¯
const filterKeywords = [
    "å¹¿å‘Š", "è¿‡æœŸ", "æ— æ•ˆ", "æµ‹è¯•", "å¤‡ç”¨", "å®˜ç½‘", "è´¦å·", "æœ‰æ•ˆæœŸ", "ç¾¤", "åˆ°æœŸ", "åˆ·æ–°", "å‰©ä½™", "è¿‡æœŸ", "ç”µæŠ¥", "ä¼šå‘˜", "è§£é”", "æµé‡", "è¶…æ—¶", "è®¢é˜…", "ä½£é‡‘", "å…ç¿»", "èŠ‚ç‚¹", "ä¸‹è½½", "æµé‡", "æ›´æ–°", "ç‚¹å¤–", "é‡ç½®", "å…æµ", "Days", "Date", "Expire", "Premium", "å»ºè®®", "å…è´¹"];

// ä¸åšå¤„ç†ä½†è¦ä¿ç•™çš„å…³é”®è¯
const skipKeywords = [
    "å¿½ç•¥", "æ— æ•ˆæœåŠ¡å™¨", "æš‚åœæœåŠ¡",  // æ·»åŠ æ‚¨å¸Œæœ›ä¿ç•™ä¸‹æ¥çš„å…³é”®è¯
];

// æ£€æŸ¥æ˜¯å¦åŒ…å«è¿‡æ»¤å…³é”®è¯
for (const filter of filterKeywords) {
    if (new RegExp(filter, 'i').test($server.title)) {
        return false;  // å¦‚æœåŒ¹é…è¿‡æ»¤å…³é”®è¯ï¼Œç›´æ¥è¿”å› false
    }
}

// æ£€æŸ¥æ˜¯å¦åŒ…å«ä¸å¤„ç†å…³é”®è¯
let matchedSkipKeyword = false;
for (const skip of skipKeywords) {
    if (new RegExp(skip, 'i').test($server.title)) {
        matchedSkipKeyword = true;  // æ ‡è®°ä¸ºåŒ¹é…äº†ä¸å¤„ç†å…³é”®è¯
        break;  // æ‰¾åˆ°åç›´æ¥è·³å‡ºå¾ªç¯
    }
}

let newTitle = $server.title;  // åˆå§‹å€¼ä¸ºåŸåç§°
let matchedReplacementKeyword = false;

// éå†å…³é”®è¯ï¼Œå¦‚æœåŒ¹é…åˆ™æ›¿æ¢åç§°
for (const keyword in keywordsToNames) {
    if (new RegExp(keyword, 'i').test($server.title)) {
        newTitle = keywordsToNames[keyword];  // æ›¿æ¢ä¸ºå¯¹åº”åç§°
        matchedReplacementKeyword = true;  // æ ‡è®°ä¸ºåŒ¹é…äº†æ›¿æ¢å…³é”®è¯
        break;  // æ‰¾åˆ°åç›´æ¥è·³å‡ºå¾ªç¯
    }
}

// æœ€ç»ˆå¤„ç†åç§°
if (matchedReplacementKeyword && matchedSkipKeyword) {
    // å¦‚æœåŒæ—¶åŒ¹é…åˆ°æ›¿æ¢å…³é”®è¯å’Œä¸å¤„ç†å…³é”®è¯ï¼Œä¸è¿›è¡Œæ›¿æ¢ï¼Œä¿ç•™åŸåç§°
    newTitle = $server.title;  // ä¿ç•™åŸåç§°
} else if (matchedReplacementKeyword) {
    // å¦‚æœåªåŒ¹é…åˆ°æ›¿æ¢å…³é”®è¯ï¼Œè¿›è¡Œæ›¿æ¢
    // newTitle å·²ç»åœ¨ä¸Šé¢è¢«èµ‹å€¼ä¸ºæŒ‡å®šåç§°
}

// æ·»åŠ å‰ç¼€å’Œåç¼€å­—ç¬¦
newTitle = customCharStart + newTitle + customCharEnd;

// æ›´æ–°æœåŠ¡å™¨æ ‡é¢˜
$server.title = newTitle;

// å¤„ç†é‡å¤è®¡æ•°
const map = globalThis.map || (globalThis.map = {});
if (!map[$server.title]) {
    map[$server.title] = 1;
} else {
    const idx = ++map[$server.title];
    $server.title = `${$server.title} - ${idx}`;
}

return true;